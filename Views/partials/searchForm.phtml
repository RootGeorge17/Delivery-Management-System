<?php if ($_SESSION['user']['currentTable'] == "Deliveries"): ?>
    <!-- Search form -->
    <div class="flex-grow-1">
        <form action="/" method="POST">
            <input type="hidden" name="_method" value="SEARCH">
            <div class="input-group">
                <input type="text" class="form-control" id="searchInputDeliveries" name="search" placeholder="Search for Parcel">
                <div class="input-group-append">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Filter by
                        </button>
                        <div class="dropdown-menu" aria-labelledby="filterDropdown">
                            <div class="dropdown-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="id" id="filterId">
                                    <label class="form-check-label" for="filterId">
                                        ID
                                    </label>
                                </div>
                            </div>
                            <div class="dropdown-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="recipientName" id="filterRecipientName">
                                    <label class="form-check-label" for="filterRecipientName">
                                        Recipient Name
                                    </label>
                                </div>
                            </div>
                            <div class="dropdown-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="postcode" id="filterPostcode">
                                    <label class="form-check-label" for="filterPostcode">
                                        Postcode
                                    </label>
                                </div>
                            </div>
                            <div class="dropdown-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="address" id="filterAddress">
                                    <label class="form-check-label" for="filterAddress">
                                        Address
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="resultsContainer"> </div>
        </form>
    </div>
<?php endif; ?>

<?php if ($_SESSION['user']['currentTable'] == "Users"): ?>
    <div class="flex-grow-1">
        <form action="/" method="POST">
            <input type="hidden" name="_method" value="SEARCH">
            <div class="input-group">
                <input type="text" class="form-control" id="searchInputUsers" name="search" placeholder="Search for Parcel">
                <div class="input-group-append">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="filterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Filter by
                        </button>
                        <div class="dropdown-menu" aria-labelledby="filterDropdown">
                            <div class="dropdown-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="id" id="filterId">
                                    <label class="form-check-label" for="filterId">
                                        ID
                                    </label>
                                </div>
                            </div>
                            <div class="dropdown-item">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="id" id="filterId">
                                    <label class="form-check-label" for="filterId">
                                        Username
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
<?php endif; ?>

<script>
    const searchInputDeliveries = document.getElementById('searchInputDeliveries');
    const resultsContainer = document.getElementById('resultsContainer');

    searchInputDeliveries.addEventListener('keyup', function() {
        liveSearch(this.value);
    });

    function liveSearch(keyword) {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', '/livesearch?action=search-delivery&keyword=' + keyword);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function() {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    const result = JSON.parse(xhr.responseText);
                    console.log(result[0]);

                    // Clear previous results
                    resultsContainer.innerHTML = '';

                    if (result.length > 0) {
                        // Create a list element to hold the results
                        const resultsList = document.createElement('ul');
                        resultsList.classList.add('list-group');

                        // Loop through the first 5 results and create a list item for each result
                        for (let i = 0; i < Math.min(result.length, 5); i++) {
                            const item = result[i];
                            const listItem = document.createElement('li');
                            listItem.classList.add('list-group-item');

                            const itemContent = `ID: ${item.id}, Name: ${item.name}, Address: ${item.address_1} ${item.address_2}, Postcode: ${item.postcode}`;
                            listItem.textContent = itemContent;

                            resultsList.appendChild(listItem);
                        }

                        // Append the results list to the container
                        resultsContainer.appendChild(resultsList);
                    } else {
                        // If no results, display a message
                        const noResultsMessage = document.createElement('p');
                        noResultsMessage.textContent = 'No results found.';
                        resultsContainer.appendChild(noResultsMessage);
                    }
                } else {
                    console.error('Error:', xhr.status);
                }
            }
        };
        xhr.send();
    }
</script>