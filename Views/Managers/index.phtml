<?php require('Views/partials/head.phtml') ?>
<?php require('Views/partials/nav.phtml') ?>
<?php require('Views/partials/header.phtml') ?>
<?php $_SESSION['user']['searched'] = false ?>
<div id="main-content">
    <div class="mt-2 m-4">
        <!-- Manager View -->
        <?php if ($_SESSION['user']['usertypename'] == "Manager"): ?>
            <h2>Admin Panel</h2>
            <?php if (isset($errors) && is_array($errors)) : ?>
                <?php foreach ($errors as $errorType => $errorData) : ?>
                    <?php foreach ($errorData as $errorKey => $errorMessage) : ?>
                        <?php if ($errorType === 'InvalidInput') : ?>
                            <div class="alert alert-danger" role="alert">
                                <ul>
                                    <li class="text-black mt-2"><?= $errorMessage ?></li>
                                </ul>
                            </div>
                        <?php endif; ?>
                    <?php endforeach; ?>
                <?php endforeach; ?>
            <?php endif; ?>

            <button id="loadMapButton">Press button to load the map with deliveries</button>
            <div id="map" class="hide"></div>
            <script src="Views/api/js/loadMap.js"></script>

            <!-- Statistics Section -->
            <section id="statistics-section">
                <h4>Statistics:</h4>
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table border-dark table-bordered table-grey table-striped">
                                <thead>
                                <tr>
                                    <th scope="col">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Total Deliveries</span>
                                            <div class="btn-group btn-group-sm mt-2">
                                                <form method="POST" action="/">
                                                    <button type="submit" name="show_deliveries" value="show" class="btn btn-sm btn-danger mx-1">
                                                        Show All Parcels
                                                    </button>
                                                </form>
                                                <button class="btn-primary btn-sm mx-1" data-bs-toggle="modal" data-bs-target="#createParcel">
                                                    Create new Parcel
                                                </button>
                                            </div>
                                        </div>
                                    </th>
                                    <th scope="col">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Total Deliverers</span>
                                            <div class="btn-group btn-group-sm mt-2">
                                                <form method="POST" action="/users">
                                                    <button type="submit" name="show_deliverers" value="show" class="btn btn-sm btn-danger mx-1">
                                                        Show All Deliverers
                                                    </button>
                                                </form>
                                                <button class="btn-primary btn-sm mx-1" data-bs-toggle="modal" data-bs-target="#createUser">
                                                    Create new User
                                                </button>
                                            </div>
                                        </div>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td><?= count($view->totalDeliveries) ?></td>
                                    <td><?= count($view->totalUsers) ?></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Create User Dynamic Modal -->
                        <div class="modal fade" id="createUser" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="statusModalLabel">Create Deliverer</h5>
                                    </div>
                                    <form method="POST" action="/users">
                                        <div class="modal-body">
                                            <span>Create a new deliverer below:</span>
                                            <div class="form-group">
                                                <label for="username">Username:</label>
                                                <input type="text" id="username" name="username" class="form-control" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="password">Password:</label>
                                                <input type="text" id="password" name="password" class="form-control" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="userType">User Type:</label>
                                                <input type="text" id="userType" name="userType" class="form-control"
                                                       placeholder="Deliverer" disabled>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <input type="hidden" name="_method" value="CREATE">
                                            <input type="hidden" name="type" value="Deliverer">
                                            <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Close
                                            </button>
                                            <button type="submit" class="btn btn-danger">Create Deliverer
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Create Parcel Dynamic Modal -->
                        <div class="modal fade" id="createParcel" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="statusModalLabel">Create Parcel</h5>
                                    </div>
                                    <form method="POST" action="/users">
                                        <div class="modal-body">
                                            <h5>Create Parcel</h5>
                                            <div class="form-group">
                                                <label for="pointName">* Name:</label>
                                                <input type="text" id="pointName" name="name"
                                                       class="form-control"
                                                       required>
                                            </div>
                                            <div class="form-group">
                                                <label for="address1">* Address Line 1:</label>
                                                <input type="text" id="address1" name="address1"
                                                       class="form-control"
                                                       required>
                                            </div>
                                            <div class="form-group">
                                                <label for="address2">Address Line 2:</label>
                                                <input type="text" id="address2" name="address2"
                                                       class="form-control"
                                            </div>
                                            <div class="form-group">
                                                <label for="postcode">* Postcode:</label>
                                                <input type="text" id="postcode" name="postcode"
                                                       class="form-control"
                                                       required>
                                            </div>
                                            <div class="form-group">
                                                <label for="latitude">* Latitude:</label>
                                                <input type="text" id="latitude" name="latitude"
                                                       class="form-control"
                                                       required>
                                            </div>
                                            <div class="form-group">
                                                <label for="longitude">* Longitude:</label>
                                                <input type="text" id="longitude" name="longitude"
                                                       class="form-control"
                                                       required>
                                            </div>
                                            <div class="form-group">
                                                <label for="deliverer">* Deliverer Username:</label>
                                                <input type="text" id="deliverer" name="deliverer"
                                                       class="form-control"
                                                       required>
                                            </div>
                                            <div class="form-group">
                                                <label for="status">* Status:</label>
                                                <div class="input-group">
                                                    <select id="status" name="status" class="form-select"
                                                            required>
                                                        <option value="Pending">
                                                            Pending
                                                        </option>
                                                        <option value="Shipped">
                                                            Shipped
                                                        </option>
                                                        <option value="Out for delivery">
                                                            Out for delivery
                                                        </option>
                                                        <option value="Delivered">
                                                            Delivered
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <input type="hidden" name="_method" value="CREATE">
                                            <input type="hidden" name="type" value="Parcel">
                                            <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Close
                                            </button>
                                            <button type="submit" class="btn btn-danger">Create Deliverer
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <?php if ($_SESSION['user']['currentTable'] == "Deliveries"): ?>
            <div class="container-fluid px-0">
                <div class="row row-cols-sm-2 row-cols-md-3 row-cols-lg-4 mx-0">
                    <?php foreach ($view->currentItems as $deliveryPointData) : ?>
                        <div class="col px-3 mb-4">
                            <div class="delivery-point">
                                <div class="delivery-point-header">
                                    <h5><?= $deliveryPointData->getPointName() ?></h5>
                                    <button id="show-on-<?= $deliveryPointData->getPointId() ?>" class="status show-on-map" data-lat="<?= $deliveryPointData->getPointLat() ?>" data-lng="<?= $deliveryPointData->getPointLng() ?>">Show on Map</button>
                                    <span class="status"><?= htmlspecialchars($deliveryPointData->getPointStatus()) ?></span>
                                </div>
                                <div class="delivery-point-body">
                                    <p><strong>ID:</strong> <?= $deliveryPointData->getPointId() ?></p>
                                    <p><strong>Address:</strong> <?= $deliveryPointData->getPointAddress1() ?>, <?= $deliveryPointData->getPointAddress2() ?>, <?= $deliveryPointData->getPointPostcode() ?></p>
                                    <p><strong>Coordinates:</strong> <?= htmlspecialchars($deliveryPointData->getPointLat()) ?> / <?= htmlspecialchars($deliveryPointData->getPointLng()) ?></p>
                                    <p><strong>Deliverer:</strong> <?= htmlspecialchars($deliveryPointData->getPointDelivererUsername()) ?></p>
                                    <?php if (htmlspecialchars($deliveryPointData->getPointDelPhoto())) : ?>
                                        <div class="delivery-photo">
                                            <img src="images/<?= htmlspecialchars($deliveryPointData->getPointDelPhoto()) ?>" alt="Delivery Photo" class="img-fluid">
                                        </div>
                                    <?php else : ?>
                                        <p>Only delivered parcels have pictures!</p>
                                    <?php endif; ?>
                                    <div class="d-flex justify-content-between mt-3">
                                    <div class="dropdown">
                                        <button class="btn btn-primary dropdown-toggle" type="button" id="statusDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            <?= htmlspecialchars($deliveryPointData->getPointStatus()) ?>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="statusDropdown">
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal" data-bs-target="#pendingModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                    Mark as: Pending
                                                </a>
                                            </li>
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal" data-bs-target="#shippedModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                    Mark as: Shipped
                                                </a>
                                            </li>
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal" data-bs-target="#outModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                    Mark as: Out for delivery
                                                </a>
                                            </li>
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal" data-bs-target="#deliveredModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                    Mark as: Delivered
                                                </a>
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- All modals from the previous code go here -->
                                    <!-- Actions -->
                                    <div class="dropdown">
                                        <button class="btn btn-danger dropdown-toggle" type="button"
                                                data-bs-toggle="dropdown"
                                                aria-expanded="false">
                                            Edit Parcel:
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="actionsDropdown">
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal"
                                                   data-bs-target="#assignModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                    Assign / Change Deliverer
                                                </a>
                                            </li>
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal"
                                                   data-bs-target="#editModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                    Edit Delivery Item
                                                </a>
                                            </li>
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal"
                                                   data-bs-target="#deleteModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                    Delete Delivery Item
                                                </a>
                                            </li>
                                        </ul>
                                    </div>


                                    <!-- Pending Status Dynamic Modal -->
                                    <div class="modal fade"
                                         id="pendingModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Change
                                                        Status</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <span>
                                                          Are you sure you want to change the status of delivery item with ID: <?= htmlspecialchars($deliveryPointData->getPointId()) ?>
                                                          from: <?= htmlspecialchars($deliveryPointData->getPointStatus()) ?> to Pending?
                                                    </span>
                                                </div>
                                                <div class="modal-footer">
                                                    <form method="POST" action="<?= $_SERVER['REQUEST_URI'] ?>">
                                                        <input type="hidden" name="_method" value="UPDATE">
                                                        <input type="hidden" name="_id"
                                                               value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                        <input type="hidden" name="_status" value="Pending">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-primary">Confirm
                                                            Change
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Shipped Status Dynamic Modal -->
                                    <div class="modal fade"
                                         id="shippedModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Change
                                                        Status</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <span>
                                                          Are you sure you want to change the status of delivery item with ID: <?= htmlspecialchars($deliveryPointData->getPointId()) ?>
                                                          from: <?= htmlspecialchars($deliveryPointData->getPointStatus()) ?> to Shipped?
                                                    </span>
                                                </div>
                                                <div class="modal-footer">
                                                    <form method="POST" action="<?= $_SERVER['REQUEST_URI'] ?>">
                                                        <input type="hidden" name="_method" value="UPDATE">
                                                        <input type="hidden" name="_id"
                                                               value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                        <input type="hidden" name="_status" value="Shipped">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-primary">Confirm
                                                            Change
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Out for Delivery Status Dynamic Modal -->
                                    <div class="modal fade"
                                         id="outModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Change
                                                        Status</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <span>
                                                          Are you sure you want to change the status of delivery item with ID: <?= htmlspecialchars($deliveryPointData->getPointId()) ?>
                                                          from: <?= htmlspecialchars($deliveryPointData->getPointStatus()) ?> to Out for delivery?
                                                    </span>
                                                </div>
                                                <div class="modal-footer">
                                                    <form method="POST" action="<?= $_SERVER['REQUEST_URI'] ?>">
                                                        <input type="hidden" name="_method" value="UPDATE">
                                                        <input type="hidden" name="_id"
                                                               value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                        <input type="hidden" name="_status"
                                                               value="Out for delivery">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-primary">Confirm
                                                            Change
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Delivered Status Dynamic Modal -->
                                    <div class="modal fade"
                                         id="deliveredModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Change
                                                        Status</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <span>
                                                          Are you sure you want to change the status of delivery item with ID: <?= htmlspecialchars($deliveryPointData->getPointId()) ?>
                                                          from: <?= htmlspecialchars($deliveryPointData->getPointStatus()) ?> to Delivered?
                                                    </span>
                                                </div>
                                                <div class="modal-footer">
                                                    <form method="POST" action="<?= $_SERVER['REQUEST_URI'] ?>">
                                                        <input type="hidden" name="_method" value="UPDATE">
                                                        <input type="hidden" name="_id"
                                                               value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                        <input type="hidden" name="_status" value="Delivered">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-primary">Confirm
                                                            Change
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Assign Deliverer Dynamic Modal -->
                                    <div class="modal fade"
                                         id="assignModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Assign Deliverer</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <form action="/" method="POST">
                                                    <div class="modal-body">
                                                <span>
                                                    You are about to assign a deliverer for parcel with ID: <?= htmlspecialchars($deliveryPointData->getPointId()) ?>
                                                </span>
                                                        <input type="hidden" name="type" value="AssignDeliverer">
                                                        <input type="hidden" name="_method" value="EDIT">
                                                        <label for="username">Deliverer Username:</label>
                                                        <input type="text" id="username" name="username" required>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <input type="hidden" name="_id"
                                                               value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">
                                                            Close
                                                        </button>
                                                        <button type="submit" class="btn btn-danger">Confirm Change
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Edit Parcel Dynamic Modal -->
                                    <div class="modal fade"
                                         id="editModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Edit
                                                        Parcel <?= htmlspecialchars($deliveryPointData->getPointId()) ?></h5>
                                                </div>
                                                <form method="POST" action="/">
                                                    <div class="modal-body">
                                                        <h5>Edit Parcel</h5>
                                                        <div class="form-group">
                                                            <label for="pointId">Parcel ID:</label>
                                                            <input type="text" id="pointId" class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                                                   disabled>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="pointName">* Name:</label>
                                                            <input type="text" id="pointName" name="name"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointName()) ?>"
                                                                   required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="address1">* Address Line 1:</label>
                                                            <input type="text" id="address1" name="address1"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointAddress1()) ?>"
                                                                   required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="address2">Address Line 2:</label>
                                                            <input type="text" id="address2" name="address2"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointAddress2()) ?>">
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="postcode">* Postcode:</label>
                                                            <input type="text" id="postcode" name="postcode"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointPostcode()) ?>"
                                                                   required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="latitude">* Latitude:</label>
                                                            <input type="text" id="latitude" name="latitude"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointLat()) ?>"
                                                                   required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="longitude">* Longitude:</label>
                                                            <input type="text" id="longitude" name="longitude"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointLng()) ?>"
                                                                   required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="deliverer">* Deliverer:</label>
                                                            <input type="text" id="deliverer" name="deliverer"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryPointData->getPointDelivererUsername()) ?>"
                                                                   required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="status">* Status:</label>
                                                            <div class="input-group">
                                                                <select id="status" name="status" class="form-select"
                                                                        required>
                                                                    <option value="Pending" <?php if (htmlspecialchars($deliveryPointData->getPointStatus()) === 'Pending') echo 'selected'; ?>>
                                                                        Pending
                                                                    </option>
                                                                    <option value="Shipped" <?php if (htmlspecialchars($deliveryPointData->getPointStatus()) === 'Shipped') echo 'selected'; ?>>
                                                                        Shipped
                                                                    </option>
                                                                    <option value="Out for delivery" <?php if (htmlspecialchars($deliveryPointData->getPointStatus()) === 'Out for delivery') echo 'selected'; ?>>
                                                                        Out for delivery
                                                                    </option>
                                                                    <option value="Delivered" <?php if (htmlspecialchars($deliveryPointData->getPointStatus()) === 'Delivered') echo 'selected'; ?>>
                                                                        Delivered
                                                                    </option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <input type="hidden" name="_id"
                                                               value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                        <input type="hidden" name="type" value="EditParcel">
                                                        <input type="hidden" name="_method" value="EDIT">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-danger">Save Changes
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Delete Parcel Dynamic Modal -->
                                    <div class="modal fade"
                                         id="deleteModal<?= htmlspecialchars($deliveryPointData->getPointId()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Delete Parcel</h5>
                                                    <button type="button" class="btn-close"
                                                            data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <span>
                                                          Are you sure you want to delete the parcel item with ID: <?= htmlspecialchars($deliveryPointData->getPointId()) ?>?
                                                    </span>
                                                </div>
                                                <div class="modal-footer">
                                                    <form method="POST" action="/">
                                                        <input type="hidden" name="_method" value="DELETE">
                                                        <input type="hidden" name="id"
                                                               value="<?= htmlspecialchars($deliveryPointData->getPointId()) ?>">
                                                        <input type="hidden" name="type" value="Parcel">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-danger">Delete
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    </div>
                                    <!-- ... -->
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
                <div class="row">
                    <div class="col-12">
                        <?php require_once('Views/partials/pagination.phtml') ?>
                    </div>
                </div>
            </div>

                <!-- Users Table -->
            <?php elseif ($_SESSION['user']['currentTable'] == "Users"): ?>
                <div class="row">
                    <?php require_once('Views/partials/searchForm.phtml') ?>
                </div>
                <?php require_once('Views/partials/pagination.phtml') ?>
                <div class="table table-responsive">
                    <table class="table border-dark table-bordered table-grey table-striped">
                        <thead class="table-dark">
                        <tr>
                            <th scope="col">User ID</th>
                            <th scope="col">Username</th>
                            <th scope="col">User Type</th>
                            <th scope="col">Actions</th>
                        </tr>
                        <!-- Status -->
                        </thead>
                        <tbody>
                        <?php foreach ($view->currentItems as $deliveryUserData) : ?>
                            <tr>
                                <th scope="row"><?= htmlspecialchars($deliveryUserData->getUserID()) ?></th>
                                <td><?= htmlspecialchars($deliveryUserData->getUserUsername()) ?></td>
                                <td>
                                    <?php
                                    if (htmlspecialchars($deliveryUserData->getUserUserType()) == 1) {
                                        echo 'Manager';
                                    } else if (htmlspecialchars($deliveryUserData->getUserUserType() == 2)) {
                                        echo 'Deliverer';
                                    }
                                    ?>
                                </td>
                                <td>
                                    <!-- Actions -->
                                    <div class="dropdown">
                                        <button class="btn btn-danger dropdown-toggle" type="button"
                                                data-bs-toggle="dropdown"
                                                aria-expanded="false">
                                            Edit User:
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="actionsDropdown">
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal"
                                                   data-bs-target="#editUserModal<?= htmlspecialchars($deliveryUserData->getUserID()) ?>">
                                                    Edit User Information
                                                </a>
                                            </li>
                                            <li>
                                                <a class="btn dropdown-item" data-bs-toggle="modal"
                                                   data-bs-target="#deleteModal<?= htmlspecialchars($deliveryUserData->getUserID()) ?>">
                                                    Delete User
                                                </a>
                                            </li>
                                        </ul>
                                    </div>

                                    <!-- Edit User Dynamic Modal -->
                                    <div class="modal fade"
                                         id="editUserModal<?= htmlspecialchars($deliveryUserData->getUserID()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Edit
                                                        User <?= htmlspecialchars($deliveryUserData->getUserID()) ?></h5>
                                                </div>
                                                <form method="POST" action="/users">
                                                    <div class="modal-body">
                                                        <h5>Edit User</h5>
                                                        <div class="form-group">
                                                            <input type="hidden" name="type" value="EditUser">
                                                            <input type="hidden" name="_method" value="EDIT">
                                                            <label for="userId">User ID:</label>
                                                            <input type="text" id="userId" class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryUserData->getUserID()) ?>"
                                                                   disabled>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="username">Username:</label>
                                                            <input type="text" id="username" name="username"
                                                                   class="form-control"
                                                                   value="<?= htmlspecialchars($deliveryUserData->getUserUsername()) ?>"
                                                                   required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="password">Password:</label>
                                                            <input type="text" id="password" name="password"
                                                                   class="form-control">
                                                            <label class="fw-bold text-danger" for="password">Leave
                                                                empty if you don't want the password changed!!!</label>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="userType">User Type:</label>
                                                            <input type="text" id="userType" name="userType"
                                                                   class="form-control"
                                                                   value="Deliverer" disabled>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <input type="hidden" name="_id"
                                                               value="<?= htmlspecialchars($deliveryUserData->getUserID()) ?>">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-danger">Save Changes
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Delete User Dynamic Modal -->
                                    <div class="modal fade"
                                         id="deleteModal<?= htmlspecialchars($deliveryUserData->getUserID()) ?>"
                                         tabindex="-1"
                                         aria-labelledby="pendingModalLabel" aria-hidden="true">
                                        <!-- Modal content for Pending -->
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <!-- Your modal content for "Pending" -->
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="statusModalLabel">Delete
                                                        User</h5>
                                                </div>
                                                <div class="modal-body">
                                                    <span>
                                                          Are you sure you want to delete the user with ID: <?= htmlspecialchars($deliveryUserData->getUserID()) ?>?
                                                    </span>
                                                </div>
                                                <div class="modal-footer">
                                                    <form method="POST" action="/users">
                                                        <input type="hidden" name="_method" value="DELETE">
                                                        <input type="hidden" name="id"
                                                               value="<?= htmlspecialchars($deliveryUserData->getUserID()) ?>">
                                                        <input type="hidden" name="type" value="Deliverer">
                                                        <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">Close
                                                        </button>
                                                        <button type="submit" class="btn btn-danger">Delete
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            <?php endif; ?>
            </section>
        <?php endif; ?>
    </div>
</div>


<?php require('Views/partials/footer.phtml') ?>
<script src="Views/api/js/showOnMap.js"></script>
